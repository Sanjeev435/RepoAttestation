<!DOCTYPE html>
<html lang="en">

<head>
<title>RBS Repo Attestation</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="http://localhost:8080/rbs/css/bootstrap.css">
<link rel="stylesheet" href="http://localhost:8080/rbs/css/custom/rbs.css">
<link rel="stylesheet" href="http://localhost:8080/rbs/css/custom/datatable.css">
	
<script src="http://localhost:8080/rbs/js/bootstrap.js"></script>
<script src="http://localhost:8080/rbs/js/jquery.min.js"></script>
<script src="http://localhost:8080/rbs/js/rbs.js"></script>

<script type="text/javascript">
	function submitAttestation(searchContent) {
		if (searchContent !== '') {
			$.ajax({
				url : contextUrl + "/view",
				type : "get", //send it through get method
				data : {
					"racfId" : searchContent
				},
				dataType : 'json',
				success : function(response) {
					console.log(response);
					appendUserAttestationData(response);
				},
				error : function(xhr) {
					console.log(xhr);
					alert('Error while searching data for user. Please contact support, if problem persist.');
				}
			});
		} else {
			alert('Please input RACF Id for search !! ');
		}
	};

	function appendUserAttestationData(records) {
		$('#userAttestationDetail tbody').empty();

		// First check if a <tbody> tag exists, add one if not
		if ($("#userAttestationDetail tbody").length == 0) {
			$("#userAttestationDetail").append("<tbody></tbody>");
		}

		for ( var index in records) {
			console.log(records[index]['project']);
			console.log(records[index]['repositoryUrl']);
			console.log(records[index]['attestedOn']);
			$("#userAttestationDetail tbody").append(
					"<tr class=\"text-center\">" 
					+ "<td scope=\"row\" class=\"text-center\">" + records[index]['projectName'] + "</td>"
					+ "<td scope=\"row\" class=\"text-center\">" + records[index]['repositoryUrl'] + "</td>"
					+ "<td scope=\"row\" class=\"text-center\">" + formatDate(records[index]['attestationTime']) + "</td>"
					+ "</tr>");
		}
	}
</script>
</head>

<body class="bg-light">

	<div class="container pills-header">
		<div class="row">
			<div class="col-sm" style="padding-right: 10%;">
				<img class="d-block mx-auto mb-4 rbs-logo"
					src="http://localhost:8080/rbs/asset/rbs.svg" alt="">
			</div>
			<div class="col-sm">
				<ul class="nav nav-pills link-piils">
					<li class="nav-item"><a href="#"
						onClick="pageRedirect('/admin/login')" class="nav-link">Admin</a></li>
					<li class="nav-item"><a href="#" onClick="pageRedirect('')"
						class="nav-link">Attestation</a></li>
					<li class="nav-item"><a href="#" class="nav-link active"
						aria-current="page">User Validation</a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="container" style="padding-top: 4em;">
		<div class="py-3 text-center">
			<h2>User Attestation Details</h2>
		</div>
		<main>
			<div class="col-md-7 col-lg-10" style="padding-left: 15%;">
				<form>
					<div class="input-group mb-3">
						<input type="text" id="userRacfSearch" class="form-control"
							placeholder="RBS RACF Id*" aria-label="RBS RACF Id*">
						<div style="padding-left: 1em;">
							<button type="button" class="w-100 btn btn-primary btn-lg"
								onclick="submitAttestation(document.getElementById('userRacfSearch').value)">Search</button>
						</div>
					</div>
				</form>
			</div>


			<div class="container" style="padding-top: 2em;">
				<table id="userAttestationDetail" class="table table-striped">
					<thead>
						<tr class="text-center">
							<th scope="col">Project Name</th>
							<th scope="col">Project URL</th>
							<th scope="col">Attestation Time</th>
						</tr>
					</thead>
				</table>
			</div>

		</main>
	</div>


</body>
</html>